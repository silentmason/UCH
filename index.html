<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Login to UCH</title>
  <meta name="description" content="Welcome to the UCH website! Sign in to access the Unightly Club Hangout and connect with fellow members.">
   <meta name="google-site-verification" content="MnycxIY1541Hu7A3wr_SPNJQSfoAjrfrrTOXaWyBEDo" />
   <link rel="icon" type="image/x-icon" href="unightly-icon.ico">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #e0f2fe;
      --accent: #60a5fa;
      --accent-hover: #3b82f6;
      --background: #0f172a;
      /* Dark background */
      --container-bg: rgba(30, 41, 59, 0.8);
      /* Semi-transparent container */
      --shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
      --radius: 12px;
      --font-family: 'Poppins', sans-serif;
      --gradient: linear-gradient(to right, #6366f1, #a855f7);
    }

    body {
      margin: 0;
      font-family: var(--font-family);
      background: var(--background);
      color: var(--primary);
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      overflow: hidden;
    }

    /* Animated background */
    body::before {
      content: "";
      position: fixed;
      top: 0;
      left: 0;
      width: 200%;
      height: 100%;
      background: var(--gradient);
      opacity: 0.3;
      z-index: -1;
      animation: wave 10s linear infinite;
    }

    @keyframes wave {
      0% {
        transform: translateX(0);
      }

      100% {
        transform: translateX(-50%);
      }
    }

    header {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      background: rgba(30, 41, 59, 0.9);
      /* Semi-transparent header */
      color: var(--primary);
      padding: 20px;
      display: flex;
      align-items: center;
      justify-content: flex-start;
      box-shadow: var(--shadow);
      z-index: 10;
    }

    .header-icon {
      width: 40px;
      height: 40px;
      border-radius: 8px;
      margin-right: 16px;
      box-shadow: 0 0 12px rgba(0, 0, 0, 0.3);
      background: #fff;
      object-fit: contain;
    }

    .header-title {
      font-size: 1.5rem;
      font-weight: 600;
      letter-spacing: 0.5px;
    }

    .container {
      max-width: 480px;
      background: var(--container-bg);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 48px 32px;
      text-align: center;
      animation: fadeIn 1s;
      z-index: 5;
      /* Ensure container is above the animated background */
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    h1 {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 0.5em;
      color: var(--primary);
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    p {
      font-size: 1.1rem;
      color: var(--primary);
      margin-bottom: 2em;
      opacity: 0.8;
    }

    .login-divider {
      margin: 32px 0 24px 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .login-divider span {
      background: #4b5563;
      height: 1px;
      width: 40%;
      display: inline-block;
    }

    .login-divider label {
      margin: 0 16px;
      color: #9ca3af;
      font-size: 1rem;
      font-weight: 500;
    }

    .cta-btn {
      display: inline-block;
      margin-top: 8px;
      padding: 14px 36px;
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      text-decoration: none;
      box-shadow: 0 4px 12px rgba(96, 165, 250, 0.4);
      transition: background 0.2s, box-shadow 0.2s, transform 0.1s;
    }

    .cta-btn:hover {
      background: var(--accent-hover);
      box-shadow: 0 6px 18px rgba(59, 130, 246, 0.5);
      transform: translateY(-2px) scale(1.03);
    }

    .google-signin-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 16px;
    }

    /* Style the Google Sign-In button directly */
    #g_id_signin {
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
      border-radius: 6px;
    }

    .login-footer {
      margin-top: 32px;
      color: #9ca3af;
      font-size: 0.95rem;
      opacity: 0.9;
    }

    .login-footer a {
      color: var(--accent);
      text-decoration: underline;
    }

    @media (max-width: 600px) {
      .container {
        margin: 32px 16px;
        padding: 32px 24px;
      }

      header {
        padding: 16px;
      }

      .header-icon {
        width: 32px;
        height: 32px;
        margin-right: 12px;
      }

      .header-title {
        font-size: 1.25rem;
      }

      h1 {
        font-size: 2rem;
      }

      p {
        font-size: 1rem;
      }

      .cta-btn {
        padding: 12px 30px;
        font-size: 1rem;
      }
    }

    /* Popup Styles */
    .popup {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: var(--container-bg);
      padding: 20px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      z-index: 1000;
      text-align: center;
    }

    .popup h3 {
      color: var(--primary);
      margin-bottom: 15px;
    }

    .popup ul {
      list-style: none;
      padding: 0;
    }

    .popup ul li {
      margin: 10px 0;
    }

    .popup button {
      padding: 10px 20px;
      background-color: var(--accent);
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

     /* Warning Popup Styles */
     #warning-popup {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: var(--container-bg);
        padding: 20px;
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        z-index: 1001; /* Ensure it's above the other popups */
        text-align: center;
    }

    #warning-popup h3 {
        color: var(--primary);
        margin-bottom: 15px;
    }

    #warning-popup textarea {
        width: 100%;
        padding: 10px;
        margin-bottom: 15px;
        border-radius: 5px;
        border: 1px solid #4b5563;
        background-color: #1e293b;
        color: var(--primary);
    }

    #warning-popup button {
        padding: 10px 20px;
        background-color: var(--accent);
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }

    #user-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--container-bg);
            padding: 20px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            z-index: 1002;
            text-align: center;
        }

        #user-popup h3 {
            color: var(--primary);
            margin-bottom: 15px;
        }

        #user-popup button {
            padding: 10px 20px;
            background-color: var(--accent);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
  </style>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script>
    // Initialize Firebase (Replace with your config)
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      databaseURL: "YOUR_DATABASE_URL",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
      appId: "YOUR_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let authorizedEmails = [];

    function parseJwt(token) {
      try {
        return JSON.parse(atob(token.split('.')[1]));
      } catch (e) {
        return null;
      }
    }

    async function fetchAuthorizedEmails() {
      try {
        const snapshot = await db.ref('authorized_emails').once('value');
        authorizedEmails = snapshot.val() || [];
        console.log("Authorized emails fetched:", authorizedEmails);
      } catch (error) {
        console.error("Error fetching authorized emails:", error);
        throw error;
      }
    }

    function handleCredentialResponse(response) {
      // Save the credential (JWT) and redirect
      localStorage.setItem('google_credential', response.credential);
      window.location.href = "blank.html";
    }

    function showUserPopup(message) {
            const popup = document.getElementById('user-popup');
            const messageElement = document.getElementById('user-popup-message');
            messageElement.textContent = message;
            popup.style.display = 'block';
        }

        function hideUserPopup() {
            document.getElementById('user-popup').style.display = 'none';
        }
    // --- Warnings Tab Functions ---
    let selectedUserEmail = null; // Track selected user's email
    function showUsernamePromptPopup() {
        // Populate the username list
        populateUsernameList();
        document.getElementById('username-prompt-popup').style.display = 'block';
    }

    function hideUsernamePromptPopup() {
      document.getElementById('username-prompt-popup').style.display = 'none';
    }

    function populateUsernameList() {
        const usernameList = document.getElementById('username-list');
        usernameList.innerHTML = ''; // Clear previous list

        // Fetch users from Firebase and populate the list
        db.ref('users').once('value', (snapshot) => {
            const users = snapshot.val();
            if (users) {
                Object.entries(users).forEach(([uid, user]) => { // Assuming 'users' node contains user objects with a unique ID (UID)
                    const li = document.createElement('li');
                    li.textContent = user.email; // Or user.username, depending on your data structure
                    li.style.cursor = 'pointer';
                    li.addEventListener('click', () => {
                        selectedUserEmail = user.email; // Set the selectedUserEmail
                        hideUsernamePromptPopup();
                        showWarningPopup();
                    });
                    usernameList.appendChild(li);
                });
            } else {
                usernameList.textContent = 'No users found.';
            }
        });
    }


    function showWarningPopup() {
        document.getElementById('warning-popup').style.display = 'block';
    }

    function hideWarningPopup() {
        document.getElementById('warning-popup').style.display = 'none';
    }

    function giveWarning() {
        const reason = document.getElementById('warning-reason').value;
        if (selectedUserEmail && reason) {
            // Store warning in Firebase
            db.ref('warnings').child(selectedUserEmail.replace(/[^a-zA-Z0-9]/g, '_')).set(reason)
                .then(() => {
                    alert(`Warning set for ${selectedUserEmail}. They will see it on their next login.`);
                    hideWarningPopup();
                })
                .catch((error) => {
                    console.error("Error saving warning to Firebase:", error);
                    alert("Failed to save warning. See console for details.");
                });
        } else {
            alert("Please select a user and enter a reason.");
        }
    }

    window.onload = async function() {
    let userEmail = null;
    try {
        const credential = localStorage.getItem('google_credential');
        if (!credential) {
            console.warn("No Google credential found in localStorage. Redirecting...");
            window.location.href = 'blank.html';
            return;
        }

        const payload = parseJwt(credential);
        userEmail = payload.email;

        if (!userEmail) {
            console.warn("No email found in JWT payload. Redirecting...");
            window.location.href = 'blank.html';
            return;
        }

        // Fetch warning from Firebase
        db.ref('warnings').child(userEmail.replace(/[^a-zA-Z0-9]/g, '_')).once('value')
            .then((snapshot) => {
                const warningReason = snapshot.val();
                if (warningReason) {
                    showUserPopup(`WARNING\nYou have been warned by UCH staff for: ${warningReason}`);
                    // Remove the warning after displaying it
                    db.ref('warnings').child(userEmail.replace(/[^a-zA-Z0-9]/g, '_')).remove();
                }
            })
            .catch((error) => {
                console.error("Error fetching warning from Firebase:", error);
            });


        let suspensionReason = localStorage.getItem(`suspension-${userEmail}`);
        if (suspensionReason) {
            showUserPopup(`WARNING\nYou have been suspended by UCH staff for: ${suspensionReason}. To appeal, go to https://discord.gg/m9uA384RJk`);
            localStorage.removeItem(`suspension-${userEmail}`); // Clear the warning
        }
    } catch (error) {
        console.error("Error during credential processing: ", error);
        window.location.href = 'blank.html';
        return;
    }
    // Load authorized emails
    try {
        await fetchAuthorizedEmails();
    } catch (error) {
        console.error("Failed to fetch authorized emails: ", error);
        window.location.href = 'blank.html';
        return;
    }
    // Check authorization status
    let isAuthorized = authorizedEmails.includes(userEmail);
    if (!isAuthorized) {
        console.log(`User ${userEmail} is not authorized. Redirecting...`);
        window.location.href = 'blank.html';
        return;
    }
    console.log(`User ${userEmail} is authorized.`);
    // Initially activate the first tab
    document.querySelector('.sidebar li').click();
      google.accounts.id.initialize({
        client_id: "90008544107-puntiddkae4hctcec08mghl6e9nhvs4k.apps.googleusercontent.com",
        callback: handleCredentialResponse
      });
      google.accounts.id.renderButton(
        document.getElementById("g_id_signin"), {
          theme: "outline",
          size: "large",
          width: "350" // Set a specific Website
        }
      );
    }
  </script>
</head>

<body>
  <header>
    <img src="unightly-icon.ico" alt="UCH Icon" class="header-icon">
    <h1 class="header-title">Unightly Club Hangout</h1>
  </header>
  <div class="container">
    <h1>Welcome to UCH</h1>
    <p>
      Sign in to access Unightly Club Hangout.<br>
    </p>
    <div class="google-signin-wrapper">
      <p style="color:#CBD5E1; margin-bottom: 12px;">To access the website, please login below.</p>
      <div id="g_id_signin"></div>
    </div>
    <div class="login-footer">
      <span>By signing in, you agree to our <a href="#" style="color:var(--accent);text-decoration:underline;">Terms</a> and <a href="#" style="color:var(--accent);text-decoration:underline;">Privacy Policy</a>.</span>
    </div>
  </div>

  <div id="username-prompt-popup" class="popup">
    <h3>Select User to Warn</h3>
    <ul id="username-list">
      <!-- User list will be populated here -->
    </ul>
    <button onclick="hideUsernamePromptPopup()">Cancel</button>
  </div>

  <div id="warning-popup" class="popup">
        <h3>Enter Warning Reason</h3>
        <textarea id="warning-reason" placeholder="Reason for warning"></textarea>
        <button onclick="giveWarning()">Give Warning</button>
        <button onclick="hideWarningPopup()">Cancel</button>
    </div>

    <div id="user-popup" class="popup">
        <h3 id="user-popup-message"></h3>
        <button onclick="hideUserPopup()">OK</button>
    </div>
</body>

</html>
```

